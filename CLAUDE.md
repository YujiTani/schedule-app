# 予約管理アプリ開発プロジェクト

## プロジェクト概要
Googleカレンダー風UIを持つシンプルな予約管理アプリケーション

## 技術スタック
- **フロントエンド**: React (TypeScript)
- **バックエンド**: Node.js + Hono フレームワーク
- **データベース**: PostgreSQL
- **外部API**: Google Calendar API
- **メール**: Gmail SMTP

## 主要機能要件

### 1. カレンダーUI
- Googleカレンダーのような見た目のUI
- 日付クリックで予約入力可能
- 1時間単位の予約システム

### 2. 予約機能
- 必要入力項目：
  - メールアドレス
  - 名前
  - 内容
- 予約確定時に予約者と管理者にメール通知

### 3. 管理者機能
- Googleカレンダーからの予定取得（6時間ごとの定期取得）
- 営業時間設定（曜日ごと設定可能）
- 営業時間外・既存予定時間帯は予約不可制御

### 4. キャンセル機能
- ユーザー：キャンセル希望の連絡のみ可能
- 管理者：実際のキャンセル操作を実行

## Google Calendar API設定
- Google Cloud Consoleでプロジェクト作成済み
- Calendar API有効化が必要
- OAuth 2.0認証情報（クライアントID・シークレット）取得が必要

## プロジェクト構成
```
schedule-app/
├── frontend/          # React アプリケーション
├── backend/           # Hono API サーバー
├── database/          # PostgreSQL設定・マイグレーション
└── docs/             # ドキュメント
```

### 6. Git・コミット規則
- **ブランチ命名**: GitHub Flow
  - `feature/feature-name`
  - `main`
- **コミットメッセージ**: Conventional Commits + 絵文字
  - ✨ feat: 新機能
  - 🐛 fix: バグ修正
  - 📚 docs: ドキュメント
  - 💄 style: スタイル変更
  - ♻️ refactor: リファクタリング
  - ✅ test: テスト追加

### 7. セキュリティルール
- **環境変数管理**: 
  - `.env`ファイルを使用
  - `.env.sample`を作成して設定項目を管理
  - local環境・本番環境ではそれぞれコピーして値を書き換えて使用
  - API キー、シークレットは環境変数で管理
- **CORS設定**: 開発段階では`*`を使用（本番時にドメイン指定に変更）
- **TODOコメント**: 本番時に変更が必要な箇所にはTODOコメントを残す

### 8. テストルール
- **テストフレームワーク**: Vitest + React Testing Library
- **テスト戦略**: 最初はE2Eテストのみ実装（TODOコメントで実装予定を記載）
- **ユニットテスト**: 初期段階では不要（仕様変更が多いため）
- **テストファイル**: 機能・コンポーネントの近くに`__test__/`ディレクトリ配下に`.test.ts`で配置

### 9. 環境・パッケージ管理
- **Node.js**: 安定版最新を使用
- **パッケージマネージャー**: npm（bunは仕様変更が多いため避ける）

### 10. コード品質ルール
- **インポート順序**: 外部ライブラリ → 内部モジュール、アルファベット順
- **関数の最大行数**: 制限なし
- **未使用コード**: 発見次第なるべく早く削除

### 11. ログ・デバッグルール
- **ログレベル定義**:
  - `error`: システムエラー、予期しない例外
  - `warn`: 警告、処理は継続するが注意が必要  
  - `info`: 一般的な情報、システムの状態変化
  - `debug`: デバッグ用詳細情報、開発時のみ
  - `trace`: 最も詳細なレベル、関数の入出力等
- **本番環境**: `console.log`は表示させない

### 12. ドキュメントルール
- **JSDoc/TSDoc**: 使用する
- **README更新タイミング**: 
  - 1機能追加毎
  - 仕様変更時
  - 基本構造完成時（動作方法、サーバー起動方法等）

### 13. 検索・情報取得ルール
- **検索が必要な時**: 常に `/gemini-search` を実行する
- **TailwindCSS使用時**: 必ず `/gemini-search` で最新情報を取得する
- **技術的な不明点**: まず `/gemini-search` で調査してから実装する

### 14. データベース設計ルール

#### 14.1 識別子
- **主キー**: UUID（`uuid-ossp`拡張機能使用）
- **補助ID**: SERIAL（auto increment）をレコードに付与
- **API**: UUIDを使用してアクセス
- **外部キー**: UUIDを使用

#### 14.2 データ型
- **時間管理**: UNIX時間（BIGINT）
- **文字列**: TEXT統一
- **金額**: INTEGER（円単位）
- **論理削除**: `deleted_at BIGINT`（UNIX時間、NULL=未削除）

#### 14.3 命名規則
- **テーブル名**: 複数形（snake_case）
- **制約名パターン**:
  - 主キー: `pk_テーブル名`
  - 外部キー: `fk_テーブル名_参照テーブル名`
  - ユニーク制約: `uq_テーブル名_カラム名`
  - チェック制約: `ck_テーブル名_カラム名`
  - インデックス: `idx_テーブル名_カラム名`

#### 14.4 履歴管理
- **論理削除**: `deleted_at`カラムで管理
- **変更履歴**: 履歴テーブルで変更内容を記録
- **作成・更新日時**: `created_at`, `updated_at`（UNIX時間）

## 開発フェーズ
1. プロジェクト基盤セットアップ
2. データベース設計・構築
3. バックエンドAPI開発
4. フロントエンド開発
5. Google Calendar API連携
6. メール通知機能
7. テスト・デバッグ